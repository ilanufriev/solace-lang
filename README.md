# Solace

Solace — экспериментальный язык программирования и набор виртуальных машин для моделирования вычислений на основе:

- комбинаторной логики (hardware-узлы);
- стековой машины (software-узлы);
- сетей Кана (network), управляющих взаимодействием всех узлов.

Язык описывается грамматикой ANTLR4 (`Solace.g4`) и исполняется на трёх VM, реализованных на Kotlin (с использованием корутин и каналов для сети Кана).

---

## Концепция

1. **Узел (node)** — единица вычисления. Бывает двух типов:
   - `hardware` — модель комбинаторной логики;
   - `software` — модель стековой машины.

2. У каждого узла есть:
   - сигнатура каналов: `in`, `out`, `self` (петля);
   - две секции кода:
     - `init { ... }` — выполняется один раз при старте;
     - `run  { ... }` — запускается в бесконечном цикле.

3. **Сеть Кана (`network`)**:
   - описывает соединения между каналами узлов;
   - в языке существует одна глобальная сеть;
   - сеть задаёт топологию обмена данными.

4. **Три уровня**:
   - фронтенд: язык Solace → AST (ANTLR4);
   - бэкенд: AST → байткод для конкретной VM;
   - рантайм: запуск сети и узлов на Kotlin (каждый узел — корутина, ребро сети — канал).

---

[**Пример программы**](pseudocode.solace)

## Дополнительно

- [Формат выходных файлов компилятора](FILE_FORMATS.md)
- Сборка демо-пакета: `./gradlew :compiler:run --args "path/to/program.solace --out build/solace"`
  - На выходе появится `build/solace/program.solpkg` с мета-инструкциями и заглушечным байткодом для всех узлов.
  - Если запускаете из каталога `compiler`, указывайте путь относительно корня репозитория (например, `../pseudocode.solace`); CLI также попробует найти файл на уровень выше.
- Запуск «немой» сети: `./gradlew :vm:network:run --args "build/solace/program.solpkg"`
  - Загружает пакет, строит сеть Кана, создаёт заглушки hardware/software ВМ и логгирует их «живость» в корутинах.
