# Сеть Кана (network VM)

Модуль `vm/network` отвечает за загрузку пакета программы (`*.solpkg`), построение сети Кана и запуск «немых» заглушек узловых ВМ.

## Что умеет

- Читает пакет формата из `FILE_FORMATS.md`: заголовок, таблицу строк, поток инструкций `NODE_DEF`/`CONNECT`, встроенные `solbc`.
- Валидирует наличие байткода для каждого узла, совпадение типов и корректность размеров секций init/run.
- Строит каналы FIFO для всех соединений, а также self-каналы узлов.
- Создаёт заглушечные hardware/software ВМ, которые просто логгируют «живой» тик с заданным интервалом.

## Запуск

- Из корня репозитория:  
  `./gradlew :vm:network:run --args "build/solace/program.solpkg"`
- Если запускаете из подкаталога (`vm/network`), можно передать путь относительно корня (по умолчанию ищется также в родительских каталогах):  
  `./gradlew run --args "../build/solace/program.solpkg"`

## Архитектура кода

- `loader.kt` — загрузка и валидация пакета, раскладка узлов/соединений в память.
- `runtime.kt` — построение сети (каналы, порты) и запуск корутин с заглушками узловых ВМ.
- `Main.kt` — CLI: читает путь до пакета, грузит его и стартует «немую» сеть.

## Заглушечные ВМ

- Реализуют интерфейс `NodeVm`, создаются через `NodeVmFactory`.
- По умолчанию используется `StubNodeVmFactory`, каждая корутина пишет в лог строку вида `[hardware] NodeName alive (tick N)` раз в секунду.
